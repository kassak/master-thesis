%-*-coding: utf-8-*-
\chapter{Тестирование}

\section{Время препроцессирования}

Тестирование проводилось на обычном домашнем компьютере
с процессором Intel Core i3, 1.7 GHz. В качестве тестовых
брались две карты черноморского побережья от г.Анапы до г.Новороссийск
масштаба 1 : 200 000.

Также были выбраны характеристики объекта поиска, примерно соответствующие
характеристикам движения человека. А именно
\begin{description}
\item[Скорость движения по шоссе] -- 5 км/ч;
\item[Скорость движения по грунтовой дороге] -- 4.5 км/ч;
\item[Скорость движения по просеке] -- 4 км/ч;
\item[Скорость движения по лесу] -- 2 км/ч;
\item[Скорость движения по кустарнику] -- 3 км/ч;
\item[Скорость движения по полю] -- 4.5 км/ч;
\item[Скорость движения по городским кварталам] -- 5 км/ч;
\item[Скорость движения по площадным водным объектам] -- 0 км/ч;
\item[Скорость движения по линейным водным объектам] -- 0 км/ч.
\end{description}

Также характеристики объекта поиска учитывают линейные реки.
Была введена штрафная функция, запрещающая пересекать широкие
реки и разрешающая пересекать узкие за 10 мин, но если в
месте пересечения реки ее пересекает дорога, то считается, что
там есть мост и штраф не назначается. Обозначим
$G_S$ -- множество типов местностей ребра $S$, $F$, $T$ --
ребра с которого и на которое осуществляется переход,
$L$, $R$ -- множества ребер, инцидентных той же вершине, что и
$F$, $T$, находящихся слева и справа от них.
Штрафы описывались следующим образом:
\begin{description}
\item["река шириной > 20м" $\in G_F \oplus G_T$] -- $\infty$ мин;
\item["река шириной < 20м" $\in G_F \oplus G_T$] -- 5 мин;
\item["река шириной > 20м" $\displaystyle\in \bigcup_{S\in L}G_S \oplus \bigcup_{S\in R}G_S$]
-- $\infty$ мин, если между берегами реки нет дороги, иначе 0;
\item["река шириной < 20м" $\displaystyle\in \bigcup_{S\in L}G_S \oplus \bigcup_{S\in R}G_S$]
-- 5 мин, если между берегами реки нет дороги, иначе 0;
\item[Иначе] -- 0 мин.
\end{description}

Программа запускалась на двух тестовых картах. На
них произвольно выбирались районы, в которых
далее решалась задача построения района поиска.
Время обработки и характеристики районов приведены в таблицах
\ref{tab:pptime1} и \ref{tab:pptime2}.

\FloatBarrier

\begin{table}[ht]
\centering
\renewcommand{\arraystretch}{1.1}
\captionbox{Время пocтроения функции кратчайших расстояний на карте 1
\label{tab:pptime1}
}{
\begin{tabular*}{1.0\textwidth}{@{\extracolsep{\fill}} |r|r|r|r|}

\hline
Площадь района интереса(км\textsuperscript{2}) & кол-во треугольников & кол-во ребер & время обработки(с) \\
\hline
  18 &   4388 &   19655 &   12 \\
  44 &   9980 &   45134 &   44 \\
 124 &  28840 &  131058 &   88 \\
 374 &  88262 &  404056 &  920 \\
1208 & 260104 & 1192990 & 1403 \\
\hline


\end{tabular*}}
\end{table}

\begin{table}[ht]
\centering
\renewcommand{\arraystretch}{1.1}
\captionbox{Время пocтроения функции кратчайших расстояний на карте 2
\label{tab:pptime2}
}{
\begin{tabular*}{1.0\textwidth}{@{\extracolsep{\fill}} |r|r|r|r|}

\hline
Площадь района интереса(км\textsuperscript{2}) & кол-во треугольников & кол-во ребер & время обработки(с) \\
\hline
  45 &   1170 &   5114 &   4 \\
 127 &   3966 &  17709 &  11 \\
 283 &   9122 &  40803 &  21 \\
 808 &  20844 &  94043 &  57 \\
2268 &  45880 & 207452 & 144 \\
\hline

\end{tabular*}}
\end{table}

\FloatBarrier
\section{Сравнение с другим методом}

Было проведено сравнение предложенного метода с методом,
основанным на растеризации карты в регулярную восьми связную сетку.
Для проведения сравнения, выбирался случайный район интереса (площадью 16, 64, 256,
1024 км\textsuperscript{2}), чей центр считался последней известной
позицией объекта поиска. Далее в этом районе производилась предобработка
данных для обоих методов. В качестве точности предложенного метода
была выбрана точность 4 сек., что примерно соответствует погрешности
5 м. на один треугольник. В качестве шага сетки второго метода были выбраны
те же 5 м., хотя очевидно, что ошибка метризации никогда не позволит
обеспечить такую точность, не увеличив связность сетки. После предобработки
были построены 10 районов поиска. Времена, на которые определялись районы поиска,
выбирались так, чтобы район поиска был полностью внутри района интереса,
для избежания краевых эффектов. В этих целях, максимальное время, на которое
определялся район поиска было выбрано, как половина времени пути до самой
удаленной точки района интереса. Остальные времена выбирались с фиксированным
шагом в сторону уменьшения. Для каждой площади района интереса испытания
проводились десять раз, результаты усреднялись.
Сравнение проводилось автоматически.

В табл. \ref{tab:comparison1}-\ref{tab:comparison4}
приведены результаты сравнительных испытаний этих методов. Как видно из
результатов, предложенный метод работает быстрее метода, основанного
на регулярной сетке, при этом он более точен. В таблицах также приведено
сравнение числа элементов подразбиения, что для предложенного метода
является суммарным число линейных частей кусочно-линейной функции
(для наглядности в скобках указано среднее подразбиение ребра), а для
второго метода -- число ячеек сетки. При ответе на запрос построения района
поиска, показательным является количество многоугольников, которые необходимо
объединить для получения района поиска. Из табл. \ref{tab:comparison4}
видно, что предложенный подход использует меньшее число многоугольников,
что позволяет ему работать в тех случаях, когда другому методу не хватило
оперативной памяти.


%\newcolumntype{R}[1]{D{.}{\cdot}{#1} }
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}m{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}m{#1}}

\begin{table}[ht]
\centering
\renewcommand{\arraystretch}{1.1}
\captionbox{Сравнение с алгоритмом, использующим регулярную сетку
\label{tab:comparison1}
}{
\begin{tabular*}{1.0\textwidth}{ |C{4cm}|R{2cm}|R{2cm}|R{2cm}|R{2cm}|}
\cline{1-5}
\hfill& \multicolumn{2}{|C{4cm}|}{\textbf{Предложенный алгоритм}} & \multicolumn{2}{C{4cm}|}{\textbf{Регулярная сетка}} \\

\cline{1-5}
Площадь района интереса & \multicolumn{4}{|R{6cm}|}{16 км\textsuperscript{2}} \\
\cline{1-5}
Время препроцессирования (сек)
& \multicolumn{2}{|R{4cm}|}{0.76}
& \multicolumn{2}{R{4cm}|}{1.17}   \\
Кол-во эл. подр.(cр. подр.) / Кол-во ячеек
& \multicolumn{2}{|R{4cm}|}{9156(14.0)}
& \multicolumn{2}{R{4cm}|}{640000} \\
\cline{1-5}
Район поиска на время (мин) & Время построения & Кол-во объектов & Время построения & Кол-во объектов \\
\cline{1-5}
2  & 0.00074 &    8 & 0.0037 &   2905 \\
4  & 0.0021  &  102 & 0.0052 &   9821 \\
6  & 0.0065  &  400 & 0.0071 &  20105 \\
8  & 0.0076  &  640 & 0.013  &  36443 \\
10 & 0.0087  &  768 & 0.018  &  58490 \\
12 & 0.01    &  948 & 0.026  &  85755 \\
14 & 0.012   & 1123 & 0.03   & 116023 \\
16 & 0.012   & 1267 & 0.04   & 148311 \\
18 & 0.014   & 1484 & 0.052  & 177456 \\
20 & 0.014   & 1625 & 0.057  & 205488 \\

\cline{1-5}

\end{tabular*}}
\end{table}

%%%%%%%%%%%%%%%%%%

\begin{table}[ht]
\centering
\renewcommand{\arraystretch}{1.1}
\captionbox{Сравнение с алгоритмом, использующим регулярную сетку
\label{tab:comparison2}
}{
\begin{tabular*}{1.0\textwidth}{ |C{4cm}|R{2cm}|R{2cm}|R{2cm}|R{2cm}|}

\cline{1-5}
Площадь района интереса & \multicolumn{4}{|R{6cm}|}{64 км\textsuperscript{2}} \\
\cline{1-5}
Время препроцессирования (сек)
& \multicolumn{2}{|R{4cm}|}{3.88}
& \multicolumn{2}{R{4cm}|}{5.02}   \\
Кол-во эл. подр.(cр. подр.) / Кол-во ячеек
& \multicolumn{2}{|R{4cm}|}{46920(14.7)}
& \multicolumn{2}{R{4cm}|}{2560000} \\
\cline{1-5}
Район поиска на время (мин) & Время построения & Кол-во объектов & Время построения & Кол-во объектов \\
\cline{1-5}
5  & 0.0056 &   295 & 0.017 &   17333 \\
11 & 0.01   &   836 & 0.03  &   72735 \\
16 & 0.014  &  1326 & 0.055 &  157588 \\
21 & 0.02   &  2149 & 0.087 &  248965 \\
27 & 0.027  &  3134 & 0.11  &  388390 \\
32 & 0.054  &  5901 & 0.18  &  606471 \\
37 & 0.084  &  9677 & 0.21  &  877505 \\
43 & 0.11   & 13389 & 0.3   & 1163230 \\
48 & 0.16   & 19138 & 0.4   & 1418422 \\
53 & 0.19   & 24737 & 0.43  & 1609334 \\
\cline{1-5}

\end{tabular*}}
\end{table}

\begin{table}[ht]
\centering
\renewcommand{\arraystretch}{1.1}
\captionbox{Сравнение с алгоритмом, использующим регулярную сетку
\label{tab:comparison3}
}{
\begin{tabular*}{1.0\textwidth}{ |C{4cm}|R{2cm}|R{2cm}|R{2cm}|R{2cm}|}

\cline{1-5}
Площадь района интереса & \multicolumn{4}{|R{6cm}|}{256 км\textsuperscript{2}} \\
\cline{1-5}
Время препроцессирования (сек)
& \multicolumn{2}{|R{4cm}|}{13.3}
& \multicolumn{2}{R{4cm}|}{26.5}   \\
Кол-во эл. подр.(cр. подр.) / Кол-во ячеек
& \multicolumn{2}{|R{4cm}|}{185326(14.9)}
& \multicolumn{2}{R{4cm}|}{10240000} \\
\cline{1-5}
Район поиска на время (мин) & Время построения & Кол-во объектов & Время построения & Кол-во объектов \\
\cline{1-5}
8  & 0.021 &   622 & 0.059 &   34756 \\
15 & 0.026 &  1257 & 0.085 &  142749 \\
23 & 0.034 &  2400 & 0.13  &  276772 \\
30 & 0.057 &  4914 & 0.18  &  521141 \\
38 & 0.099 &  9905 & 0.32  &  919235 \\
45 & 0.13  & 15375 & 0.46  & 1478305 \\
53 & 0.21  & 25644 & 0.67  & 2196696 \\
60 & 0.24  & 31996 & 0.95  & 3119538 \\
68 & 0.27  & 37986 & 1.1   & 4350680 \\
75 & 0.38  & 51574 & 1.5   & 5655174 \\
\cline{1-5}

\end{tabular*}}
\end{table}

\begin{table}[ht]
\centering
\renewcommand{\arraystretch}{1.1}
\captionbox{Сравнение с алгоритмом, использующим регулярную сетку
\label{tab:comparison4}
}{
\begin{tabular*}{1.0\textwidth}{ |C{4cm}|R{2cm}|R{2cm}|R{2cm}|R{2cm}|}

\cline{1-5}
Площадь района интереса & \multicolumn{4}{|R{6cm}|}{1024 км\textsuperscript{2}} \\
\cline{1-5}
Время препроцессирования (сек)
& \multicolumn{2}{|R{4cm}|}{76}
& \multicolumn{2}{R{4cm}|}{128}   \\
Кол-во эл. подр.(cр. подр.) / Кол-во ячеек
& \multicolumn{2}{|R{4cm}|}{869529(15.3)}
& \multicolumn{2}{R{4cm}|}{40960000} \\
\cline{1-5}
Район поиска на время (мин) & Время построения & Кол-во объектов & Время построения & Кол-во объектов \\
\cline{1-5}
13  & 0.087 & 1069   & 0.22 & 100946 \\
25  & 0.1   & 2844   & 0.28 & 340862 \\
38  & 0.19  & 9907   & 0.46 & 918544 \\
50  & 0.27  & 22380  & 0.65 & 1939039 \\
63  & 0.31  & 33541  & 1.1  & 3492441 \\
75  & 0.46  & 51756  & 1.7  & 5818536 \\
88  & 0.65  & 77954  & 2.5  & 8600438 \\
100 & 0.86  & 106678 & --   & -- \\
113 & 1.2   & 148215 & --   & -- \\
125 & 1.4   & 193374 & --   & -- \\
\cline{1-5}

\end{tabular*}}
\end{table}

\FloatBarrier
